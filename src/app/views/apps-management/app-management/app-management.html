<div class='row show-header top-buffer-4'>
  <div class='col-xs-12'>
    <a ui-sref="home.apps-management" class='text-muted'>
      <i class='fa fa-chevron-left'></i>
      {{ 'mno_enterprise.templates.dashboard.app_management.back' | translate }}
    </a>
  </div>
</div>

<mno-loader ng-show="vm.isLoading" class='top-buffer-4'></mno-loader>
<div class='row dashboard-app-management' ng-if="!vm.isLoading">
  <div class='col-xs-12 bottom-buffer-3'>
    <div class='col-xs-offset-1'>
      <h2>
        <img class='app-logo' ng-src="{{vm.app.logo}}">
        <label class='margin-left-20'>{{vm.app.app_name}}</label>
      </h2>
    </div>

    <uib-tabset active='active'>
      <uib-tab index='0'>
        <div uib-tab-heading>
          {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.title' | translate }}
        </div>
        <div class='row'>
          <div class='col-xs-12'>
            <div>
              <h3>
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.description' | translate }}
              </h3>
              <p>
                {{vm.app.name}}: {{vm.app.tiny_description}}
              </p>
              <p>
                <a ui-sref="home.marketplace.app({appId: vm.app.app_nid})">
                  {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.description_details' | translate }}
                </a>
              </p>
            </div>

            <div>
              <h3>
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.getting_started' | translate }}
              </h3>
              <p ng-bind-html="vm.app.getting_started"></p>
            </div>

            <div>
              <h3>
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.support.title' | translate }}
              </h3>
              <div>
                <a ng-href="{{ vm.app.support_url }}" target='_blank'>
                  {{'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.support.helpdesk' | translate:{app_name: vm.app.app_name} }}
                </a>
              </div>
              <div>
                <!-- TODO: Confirm Knowledge base URL -->
                <a href='https://maestrano.atlassian.net/wiki/x/NIFpAQ' target='_blank'>
                  {{'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.support.knowledge_base' | translate }}
                </a>
              </div>
            </div>

            <div>
              <h3>
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.technical_details.title' | translate }}
              </h3>
              <p>
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.technical_details.details' | translate }}
              </p>
              <div>
                <label>
                  {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.technical_details.organization_id' | translate }}
                </label>
                <span>{{vm.organization.uid}}</span>
              </div>
              <div>
                <label>
                  {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.app_info.technical_details.group_id' | translate }}
                </label>
                <span>{{vm.app.uid}}</span>
              </div>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index='1' disable="!vm.dataSharingEnabled">
        <div uib-tab-heading>
          {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.connection_status.title' | translate }}
        </div>

        <div class='row'>
          <div class='col-xs-12'>
            <div>
              <label>
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.connection_status.title' | translate }}
              </label>
              <span>{{vm.dataSharingStatus()}}</span>
            </div>
            <!-- TODO: Add logic to add message "This application does not
                       provide a connection status" when data sharing is not
                       available -->
            <div>
              <label>
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.connection_status.last_sync' | translate }}
              </label>
              <!-- TODO: Decide between "Never" and "Sync in progress" -->
              <span>{{vm.app.last_sync_at || 'Sync In progress'}}</span>
            </div>
            <div>
              <!-- TODO: Add conditions to manage when this button
                         should be shown(APPINT-1044) -->
              <button>Access Add-on setting</button>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index='2'>
        <div uib-tab-heading>
          {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.update_subscription' | translate }}
        </div>

        <div class='row'>
          <div class='col-xs-12'>
            <mno-loader ng-show="vm.isCurrentSubscriptionLoading" class='top-buffer-4'></mno-loader>
            <div ng-show="!vm.isCurrentSubscriptionLoading" class='table-cell'>
              <div class='row th-row hidden-xs'>
                <div class='col-xs-10 col-xs-offset-2'>
                  <div class='cell col-sm-3'>{{ 'mno_enterprise.templates.dashboard.provisioning.order.name' | translate }}</div>
                  <div class='cell col-sm-5'>{{ 'mno_enterprise.templates.dashboard.provisioning.order.description' | translate }}</div>
                  <div class='cell col-sm-3'>{{ 'mno_enterprise.templates.dashboard.provisioning.order.price' | translate }}</div>
                </div>
              </div>

              <div class='row td-row' ng-if="vm.currentSubscription.product.pricing_plans.length === 0">
                <div class='cell col-md-12 text-center'>
                  {{ 'mno_enterprise.templates.dashboard.provisioning.order.no_pricing_found' | translate }}
                </div>
              </div>

              <div class='row td-row' ng-repeat="pricingPlan in vm.currentSubscription.product.pricing_plans" ng-click="vm.select_plan(pricingPlan)">
                <div class='cell radio-selector col-xs-2'>
                  <input type='radio' name='optradio' ng-change="vm.toggleSubscriptionNext(pricingPlan.id)" ng-model="vm.currentSubscription.product_pricing.id" ng-value="pricingPlan.id">
                </div>

                <div class='col-xs-10'>
                  <div class='cell col-sm-3'>
                    <span class='cell-label visible-xs-inline'>
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.name' | translate }}:
                    </span>
                    {{ pricingPlan.name }}
                  </div>

                  <div class='cell col-sm-5'>
                    <span class='cell-label visible-xs-inline'>
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.description' | translate }}:
                    </span>
                    {{ pricingPlan.description }}
                  </div>

                  <div class='cell col-sm-3'>
                    <span class='cell-label visible-xs-inline'>
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.price' | translate }}:
                    </span>
                    <span ng-if="vm.pricedPlan(pricingPlan)" ng-repeat="price in pricingPlan.prices | filterBy: ['currency']: vm.orgCurrency" class='badge'>
                      {{ price.currency }} {{ price.price_cents / 100 }}
                    </span>
                    <span ng-show="pricingPlan.pricing_type == 'recurring'">
                      / {{ pricingPlan.per_unit }} / {{ pricingPlan.per_duration }}
                    </span>
                    <span ng-show="pricingPlan.pricing_type == 'payg'">
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.pricing_type.payg' | translate }}
                    </span>
                    <span ng-show="pricingPlan.pricing_type == 'free'">
                      {{ 'mno_enterprise.templates.dashboard.provisioning.order.pricing_type.free' | translate }}
                    </span>
                  </div>
                </div>
              </div>

              <button class='btn btn-primary top-buffer-1 pull-right' ng-click="vm.nextSubscription()" ng-disabled="vm.isSubChanged" translate>
                mno_enterprise.templates.dashboard.provisioning.order.next
              </button>
            </div>
          </div>
        </div>
      </uib-tab>
      <uib-tab index='3'>
        <div uib-tab-heading>
          {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.order_history.title' | translate }}
        </div>

        <div class='row'>
          <div class='col-xs-12'>
            <mno-loader ng-show="vm.isOrderHistoryLoading" class='top-buffer-4'></mno-loader>
            <div ng-show="!vm.isOrderHistoryLoading" class='well order-histroy top-buffer-2'>
              <div class='bottom-buffer-3'>
                <div class='row subscription-event'>
                  <div class='col-sm-4'>
                    <label>
                      {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.order_history.start_date' | translate }}
                    </label>
                  </div>
                  <div class='col-sm-4'>
                    <label>
                      {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.order_history.offer_name' | translate }}
                    </label>
                  </div>
                  <div class='col-sm-4'>
                    <label>
                      {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.order_history.status' | translate }}
                    </label>
                  </div>
                </div>
              </div>
              <div ng-repeat="subscription in vm.subscriptionsHistory">
                <div class='row'>
                  <div class='col-sm-4'>{{ subscription.start_date | amDateFormat: 'L' }}</div>
                  <div class='col-sm-4'>{{ subscription.product_pricing.name }}</div>
                  <div class='col-sm-4'>{{ subscription.status }}</div>
                </div>
              </div>
              <span ng-show="vm.subscriptionsHistory.length == 0">
                {{ 'mno_enterprise.templates.dashboard.app_management.manage.tab.order_history.no_history' | translate }}
              </span>
            </div>
          </div>
        </div>
      </uib-tab>
    </uib-tabset>
  </div>
</div>
