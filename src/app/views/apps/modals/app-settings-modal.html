<div id="app-settings-modal">
  <div class="modal-header">
    <div class="close" type="button" aria-label="Close" ng-click="modal.close()">×</div>
    <h3><b>{{ 'mno_enterprise.templates.impac.dock.settings.settings' | translate }}</b> - <span class="app-name">{{app.name}}</span></h3>
  </div>
  <div class="modal-body">
    <div class="container-fluid">
      <div class="row top-buffer-1">
        <div class="col-md-3">
          <span class="title">{{ 'mno_enterprise.templates.impac.dock.settings.status' | translate }}</span>
        </div>
        <div class="col-md-8">
          <span class="label" ng-class="app.status">{{ 'mno_enterprise.templates.impac.dock.settings.app_states.' + app.status | translate }}</span>
        </div>
      </div>
      <!-- Add on settings -->
      <div ng-show="helper.isAddOnSettingShown(app)">
        <hr>
        <uib-tabset active="activeJustified" justified="true">
          <uib-tab index="0" heading="History" ng-click="loadSyncs()" select="selectHistory()">
            <h4 class="text-center" style="margin-bottom: 20px; margin-top: 20px">List of previous synchronizations:</h4>
            <mno-sortable-table row-collection="syncs.list" fields="mnoSyncsTableFields" is-loading="syncs.loading" pipe="sortableSyncsServerPipe"></mno-sortable-table>

            <div class="pagination">
              <mno-pagination
                page="syncs.page"
                nb-items="syncs.baseSize"
                total-items="syncs.totalItems"
                on-change-cb="syncs.pageChangedCb(page)"
                is-loading="syncs.loading">
              </mno-pagination>
            </div>
          </uib-tab>

          <uib-tab index="1" heading="Data" select="selectData()">
            <uib-accordion close-others=true>
              <div uib-accordion-group class="panel-default" ng-repeat="entity in app.addon_organization.displayable_synchronized_entities" is-open="status.open" ng-click="fetchIdMaps(entity.external_names, status.open)">
                <uib-accordion-heading>
                  {{entity.external_name}} <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': status.open, 'glyphicon-chevron-right': !status.open}"></i>
                </uib-accordion-heading>
                <mno-sortable-table row-collection="idMaps.list" fields="mnoIdMapsTableFields" is-loading="idMaps.loading" pipe="sortableIdMapsServerPipe"></mno-sortable-table>
                <div class="pagination">
                  <mno-pagination
                    page="idMaps.page"
                    nb-items="idMaps.baseSize"
                    total-items="idMaps.totalItems"
                    on-change-cb="idMaps.pageChangedCb(page)"
                    is-loading="idMaps.loading">
                  </mno-pagination>
                </div>
              </div>
            </uib-accordion>
          </uib-tab>

          <uib-tab index="2" heading="Entities" select="selectEntities()">
            <h4 class="text-center" style="margin-bottom: 20px; margin-top: 20px">Chose which entities you want to synchronize</h4>

            <table class="table-striped table-condensed">
              <tr>
                <th>Entity&nbsp</th>
                <th>From Connec™ to Neto&nbsp</th>
                <th>From Neto to Connec™&nbsp</th>
              </tr>
              <tr ng-repeat="entity in app.addon_organization.displayable_synchronized_entities">
                <td>{{entity.connec_name}}&nbsp</td>
                <td align="center"><input type="checkbox" ng-model="entity.can_push_to_external" checked="entity.can_push_to_external"/></td>
                <td align="center"><input type="checkbox" ng-model="entity.can_push_to_connec" checked="entity.can_push_to_connec"/></td>
              </tr>
            </table>
          </uib-tab>
        </uib-tabset>
      </div>
      <!-- Data Sharing -->
      <div ng-show="helper.isDataSyncShown(app) || helper.isDataDisconnectShown(app)">
        <hr>
        <div class="row">
          <div class="col-md-3">
            <span class="title">{{ 'mno_enterprise.templates.impac.dock.settings.manual_data_sharing' | translate }}</span>
          </div>
          <div class="col-md-8">
            <!-- Connected company name -->
            <div ng-show="helper.companyName(app)">
              {{ 'mno_enterprise.templates.impac.dock.settings.linked_to' | translate }}: {{ helper.companyName(app) | truncate:45 }}
            </div>
          </div>
        </div>
        <div class="align-center centered-buttons top-buffer-1">
          <!-- Data Sync Button -->
          <div class="left-side">
            <div ng-show="helper.isDataSyncShown(app)">
              <a class="btn btn-info" ng-href="{{helper.dataSyncPath(app)}}" uib-tooltip="{{ 'mno_enterprise.templates.dashboard.apps_list.manual_data_sync_tooltip' | translate:{ appname: app.app_name } }}">{{ 'mno_enterprise.templates.impac.dock.settings.manual_data_sync' | translate }}</a>
            </div>
          </div>
          <!-- Data Disconnect Button -->
          <div ng-show="helper.isDataDisconnectShown(app)">
            <a class="btn btn-danger" ng-click="helper.dataDisconnectClick(app)" href="" uib-tooltip="{{ 'mno_enterprise.templates.dashboard.apps_list.disconnect_link_tooltip' | translate:{ appname: app.app_name } }}">
              {{ 'mno_enterprise.templates.impac.dock.settings.disconnect_link' | translate }}
            </a>
          </div>
        </div>
      </div>
      <!-- Deletion -->
      <hr>
      <div ng-show="helper.canDeleteApp()" class="app-deletion">
        <div class="col-xs-13">
          <div class="panel-group">
            <div class="btn-toolbar">
              <button class="btn btn-warning" ng-hide="!helper.isAddOnSettingShown(app)" ng-click="disconnect()">  Disconnect
                <i class="fa fa-refresh fa-spin" ng-if="isDisconnecting"></i>
              </button>
              <button class="btn btn-danger" ng-hide="app.showDelete" ng-click="app.showDelete = !app.showDelete">{{ 'mno_enterprise.templates.impac.dock.settings.delete' | translate }}</button>
              <div class="pull-right">
                <button class="btn btn-success" ng-if="isLeftFooterButtonShown && helper.isAddOnSettingShown(app)" ng-click="callToAction()">{{textForFooterButton}}</button>
              </div>
            </div>
            <div class="btn-group pull-right">
              <button class="btn btn-success" ng-if="isLeftFooterButtonShown && helper.isAddOnSettingShown(app)" ng-click="callToAction()">{{textForFooterButton}}</button>
            </div>
          </div>
        </div>
        <div ng-show="app.showDelete">
          <h4>{{ 'mno_enterprise.templates.impac.dock.settings.confirm_app_deletion' | translate }}</h4>
          <div ng-show="app.plan.currentBillingType == 'monthly'">
            <p class="text-error">
              {{ 'mno_enterprise.templates.impac.dock.settings.please_note_this_app' | translate }}
            </p>
          </div>
          <p>
            {{ 'mno_enterprise.templates.impac.dock.settings.delete_instructions' | translate }}</span>
            <br/>
            <span class="text-error deletion-sentence align-center"><strong>{{ sentence | translate }}</strong></span>
          </p>
          <div>
            <input type="text" class="sentence-check" ng-model="sentenceCheck" required>
          </div>
          <div class="buttons">
            <button class="btn btn-default" ng-click="app.showDelete=false" >{{ 'mno_enterprise.templates.impac.dock.settings.cancel' | translate}}</button>
            <button class="btn btn-danger" ng-click="deleteApp()" ng-disabled="sentence != sentenceCheck || modal.loading">
              <span ng-show="modal.loading"><i class="fa fa-spinner fa-pulse"></i>&nbsp;</span>
              {{ 'mno_enterprise.templates.impac.dock.settings.delete' | translate }} </button>
          </div>
        </div>
      </div>
      <!-- Developer details -->
      <div ng-show="helper.canDeleteApp()">
        <hr>
        <a class="text-muted" href="" ng-click="app.showDevDetails = !app.showDevDetails"><em> {{ 'mno_enterprise.templates.impac.dock.settings.developer_details.' + (app.showDevDetails ? 'hide' : 'show') | translate }} </em></a>
        <div ng-show="app.showDevDetails">
          <h4>{{ 'mno_enterprise.templates.impac.dock.settings.developer_details.title' | translate }} </h4>
          <div class="developer-details">
            <dl class="dl-horizontal">
              <dt>{{ 'mno_enterprise.templates.impac.dock.settings.organization_id' | translate }}:</dt>
              <dd>{{organization_uid}}</dd>
              <dt>{{ 'mno_enterprise.templates.impac.dock.settings.group_id' | translate }}:</dt>
              <dd>{{app.uid}}</dd>
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
